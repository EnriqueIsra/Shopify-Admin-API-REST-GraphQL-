<mat-card>
  <mat-card-title>Orders (REST)</mat-card-title>
</mat-card>

<mat-card-content>
  <div style="margin-bottom: 12px">
    <button mat-raised-button color="primary" (click)="goCreate()">Crear nuevo pedido</button>
    <button mat-button (click)="fetchOrders()" style="margin-left: 8px">Refrescar</button>
    <button mat-button (click)="goHome()" style="margin-left: 8px">Volver</button>
  </div>

  <!-- Encabezado tipo tabla -->
  <div class="header-row mat-elevation-z2">
    <div class="col number">Pedido</div>
    <div class="col customer">Cliente</div>
    <div class="col date">Fecha</div>
    <div class="col total">Total</div>
  </div>

  <mat-accordion multi>
    <mat-expansion-panel *ngFor="let order of orders" class="order-panel">
      <!-- ENCABEZADO DEL PANEL -->
      <mat-expansion-panel-header>
        <div class="panel-row">
          <div class="col number">#{{ order.order_number }}</div>

          <div *ngIf="order.customer; else noCustomer">
            <p>ID: {{ order.customer.id }}</p>
          </div>

          <ng-template #noCustomer>
            <p>Sin cliente asociado</p>
          </ng-template>

          <div class="col date">
            {{ order.created_at_formatted }}
          </div>

          <div class="col total">
            {{ order.total_price | currency }}
          </div>
        </div>
      </mat-expansion-panel-header>

      <!-- CONTENIDO DEL PANEL -->
      <div class="order-details">
        <p><strong>Tags:</strong> {{ order.tags }}</p>
        <p><strong>Estado:</strong> {{ order.financial_status }}</p>
        <p><strong>Total de artículos:</strong> {{ order.total_items }}</p>

        <!-- TABLA DE ARTÍCULOS -->
        <table
          mat-table
          [dataSource]="order.items"
          class="mat-elevation-z1"
          style="width: 100%; margin-top: 10px"
        >
          <!-- Artículo -->
          <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef>Artículo</th>
            <td mat-cell *matCellDef="let item">{{ item.title }}</td>
          </ng-container>

          <!-- Cantidad -->
          <ng-container matColumnDef="quantity">
            <th mat-header-cell *matHeaderCellDef>Cant.</th>
            <td mat-cell *matCellDef="let item">{{ item.quantity }}</td>
          </ng-container>

          <!-- Precio -->
          <ng-container matColumnDef="price">
            <th mat-header-cell *matHeaderCellDef>Precio</th>
            <td mat-cell *matCellDef="let item">{{ item.price | currency }}</td>
          </ng-container>

          <!-- SKU -->
          <ng-container matColumnDef="sku">
            <th mat-header-cell *matHeaderCellDef>SKU</th>
            <td mat-cell *matCellDef="let item">{{ item.sku }}</td>
          </ng-container>

          <!-- Variant ID -->
          <ng-container matColumnDef="variant_id">
            <th mat-header-cell *matHeaderCellDef>Variant ID</th>
            <td mat-cell *matCellDef="let item">{{ item.variant_id }}</td>
          </ng-container>

          <tr
            mat-header-row
            *matHeaderRowDef="['title', 'quantity', 'price', 'sku', 'variant_id']"
          ></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: ['title', 'quantity', 'price', 'sku', 'variant_id']"
          ></tr>
        </table>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</mat-card-content>
